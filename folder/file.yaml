



# autogenerated file
---
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: frontoffice-app
  namespace: match
  labels:
    name: frontoffice-app
    group: frontoffice
    tier: frontend
spec:
  replicas: 1
  revisionHistoryLimit: 5
  template:
    metadata:
      name: frontoffice-app
      namespace: match
      labels:
        name: frontoffice-app
        group: frontoffice
        tier: frontend
    spec:
      containers:
      - name: php-fpm
        ### TAGGER AUTO GENERATED DO NOT REMOVE COMMENTS @(:latest|v[0-9]\(.[0-9])*\(.[0-9])*)@ ###
        image: eu.gcr.io/namespace-gke/project:latest
        imagePullPolicy: Always
        command: ["php-fpm7"]
        env:
        - name: VERSION
          value: latest
        - name: DATABASE_DRIVER
          value: pdo_mysql
        # Connect to the SQL proxy over the local network on a fixed port.
        - name: DATABASE_HOST
          value: 127.0.0.1
        # Secrets
        - name: SECRET
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: app.secret
        - name: DATABASE_PASSWORD
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: mysql.password
        - name: MAILER_USER
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: smtp.user
        - name: MAILER_PASSWORD
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: smtp.password
        - name: RABBITMQ_DEFAULT_PASS
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: rabbitmq.password
        - name: MIXPANEL
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: mixpanel.token
        - name: OAUTH2_FACEBOOK_ID
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: oauth2.facebook.id
        - name: OAUTH2_FACEBOOK_SECRET
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: oauth2.facebook.secret
        - name: OAUTH2_GOOGLE_ID
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: oauth2.google.id
        - name: OAUTH2_GOOGLE_SECRET
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: oauth2.google.secret
        - name: BO_OAUTH2_GOOGLE_ID
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: bo.oauth2.google.id
        - name: BO_OAUTH2_GOOGLE_SECRET
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: bo.oauth2.google.secret
        - name: GOOGLE_TAG_MANAGER_ID
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: google.tag.manager.id
        # Config maps
        - name: REDIS_HOST
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: redis.master.host
        - name: DATABASE_USER
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: mysql.user
        - name: DATABASE_NAME
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: mysql.database
        - name: RABBITMQ_HOST
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: rabbitmq.host
        - name: RABBITMQ_DEFAULT_USER
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: rabbitmq.user
        - name: RABBITMQ_DEFAULT_VHOST
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: rabbitmq.vhost
        - name: MAILER_HOST
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: smtp.host
        - name: MAILER_PORT
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: smtp.port
        - name: CDN_URL
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: app.cdn.url
        - name: MATCH_SEARCH_CDN_URL
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: search.cdn.url
        - name: MATCH_SEARCH_HOST
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: search.host
        - name: SOCIAL_GOOGLE_URL
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: social.google.url
        - name: SOCIAL_LINKEDIN_URL
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: social.linkedin.url
        - name: SOCIAL_TWITTER_URL
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: social.twitter.url
        - name: SOCIAL_TWITTER_ACCOUNT
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: social.twitter.account
        - name: SOCIAL_INSTAGRAM_URL
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: social.instagram.url
        - name: SOCIAL_FACEBOOK_URL
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: social.facebook.url
        - name: COPYRIGHT_DATES
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: app.copyright.dates
        - name: COMPANY_NAME
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: app.company.name
        - name: COMPANY_HASHTAG
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: app.company.hashtag
        - name: UPLOADCARE_PUBLIC_KEY
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: uploadcare.public.key
        - name: UPLOADCARE_PRIVATE_KEY
          valueFrom:
            secretKeyRef:
              name: frontoffice-app
              key: uploadcare.private.key
        - name: UPLOADCARE_CDN_BASE
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: uploadcare.cdn.base
        - name: FROM_ADDRESS
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: from.address
        - name: FROM_SENDER_NAME
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: from.sender.name
        - name: APP_SELF_HOST
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: app.self.host
        - name: APP_SELF_SCHEME
          valueFrom:
            configMapKeyRef:
              name: frontoffice-app
              key: app.self.scheme
        ports:
          - containerPort: 9000
      - name: nginx
	image: eu.gcr.io/namespace-gke/project:latest
        imagePullPolicy: Always
        readinessProbe:
          httpGet:
            path: /healthz
            port: 80
          periodSeconds: 5
          timeoutSeconds: 1
          successThreshold: 1
          failureThreshold: 5
        command: ["nginx", "-g", "daemon off;"]
        volumeMounts:
        - name: frontoffice-nginx
          mountPath: /etc/nginx/conf.d
        ports:
          - containerPort: 80
      - name: cloudsql-proxy
        image: b.gcr.io/cloudsql-docker/gce-proxy:1.05
        command: ["/cloud_sql_proxy", "--dir=/cloudsql",
                  "-instances=bap-match:europe-west1:match-mysql-production=tcp:3306",
                  "-credential_file=/secrets/cloudsql/credentials.json"]
        volumeMounts:
          - name: frontoffice-cloudsql
            mountPath: /secrets/cloudsql
            readOnly: true
          - name: frontoffice-ssl-certs
            mountPath: /etc/ssl/certs
          - name: cloudsql
            mountPath: /cloudsql
      volumes:
      - name: frontoffice-nginx
        configMap:
          name: frontoffice-nginx
      - name: frontoffice-cloudsql
        secret:
          secretName: frontoffice-cloudsql
      - name: frontoffice-ssl-certs
        hostPath:
          path: /etc/ssl/certs
      - name: cloudsql
